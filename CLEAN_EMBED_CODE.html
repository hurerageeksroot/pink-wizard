<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PinkWizard Clean Embed</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .embed-container {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        iframe {
            width: 100%;
            height: 800px;
            border: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>75 Hard Challenge - PinkWizard Integration</h1>

        <div class="embed-container">
            <iframe 
                id="pinkwizard-iframe"
                src="https://warm-reach-wiz.lovable.app"
                title="PinkWizard Outreach Tracker">
            </iframe>
        </div>
    </div>

    <script>
        let iframe;
        
        window.addEventListener('DOMContentLoaded', function() {
            iframe = document.getElementById('pinkwizard-iframe');
            
            // Listen for messages from the iframe
            // Set up message listener for iframe communication
            window.addEventListener('message', function(event) {
                console.log('[Parent] Received message from iframe:', event.data);
                
                if (event.data?.type === 'REQUEST_PINKWIZARD_OUTREACH_COUNTS') {
                    console.log('[Parent] Iframe requesting outreach counts');
                    // Send your actual 75 Hard outreach data
                    sendCurrentData();
                }
                
                if (event.data?.type === 'REQUEST_PINKWIZARD_AUTH') {
                    console.log('[Parent] Iframe requesting auth token');
                    // Send session token instead of credentials
                    sendSessionToken();
                }
                
                if (event.data?.type === 'PINKWIZARD_AUTH_RESULT') {
                    console.log('[Parent] Auth result from iframe:', event.data);
                }
            });
        });

        function sendCurrentData() {
            console.log('[Parent] Sending current 75 Hard data to iframe');
            // Replace with your actual 75 Hard app data
            const currentData = {
                day: 15,                    // Current challenge day
                coldOutreach: 8,            // Cold outreach count
                nurturingOutreach: 12,      // Nurturing outreach count  
                totalOutreach: 20,          // Total outreach count
                lastUpdated: new Date().toISOString()
            };
            
            sendDataToIframe(currentData);
        }

        function sendSessionToken() {
            console.log('[Parent] Attempting to send session token to iframe');
            // Get current session from your Supabase client
            // Replace this with your actual Supabase instance
            if (window.supabase) {
                console.log('[Parent] Supabase client found, getting session');
                window.supabase.auth.getSession().then(({ data: { session }, error }) => {
                    if (error) {
                        console.error('[Parent] Error getting session:', error);
                        return;
                    }
                    
                    if (session && session.access_token) {
                        console.log('[Parent] Valid session found, sending to iframe');
                        // Send session tokens to iframe
                        if (iframe && iframe.contentWindow) {
                            iframe.contentWindow.postMessage({
                                type: 'PINKWIZARD_AUTH_TOKEN',
                                payload: {
                                    access_token: session.access_token,
                                    refresh_token: session.refresh_token
                                }
                            }, '*');
                        }
                    } else {
                        console.error('[Parent] No valid Supabase session found for PinkWizard auth');
                    }
                }).catch(err => {
                    console.error('[Parent] Error in getSession:', err);
                });
            } else {
                console.error('[Parent] Supabase client not available. Please ensure window.supabase is set.');
            }
        }

        function sendDataToIframe(data) {
            console.log('[Parent] Sending data to iframe:', data);
            if (iframe && iframe.contentWindow) {
                iframe.contentWindow.postMessage({
                    type: 'PINKWIZARD_OUTREACH_COUNTS',
                    payload: data
                }, '*');
            } else {
                console.error('[Parent] Iframe not ready or contentWindow not available');
            }
        }

        // Auto-send data when iframe loads
        setTimeout(function() {
            sendCurrentData();
            sendSessionToken();
        }, 3000);
    </script>
</body>
</html>